<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜ì–‘ì†Œ ì¶”ì²œ ì„¤ë¬¸</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background:#fafafa; }
    .wrap { max-width: 760px; margin: 0 auto; padding: 20px; }
    .card { background:#fff; border:1px solid #e6e6e6; border-radius:12px; padding:16px; margin-bottom:12px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .q { font-weight: 700; margin-bottom: 10px; }
    .opts label { display:block; padding:10px 12px; border:1px solid #ddd; border-radius:10px; margin:8px 0; cursor:pointer; }
    .opts input { margin-right: 10px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    button { width:100%; padding:12px; border-radius:10px; border:0; background:#111; color:#fff; font-weight:700; cursor:pointer; }
    button:disabled { background:#888; cursor:not-allowed; }
    .muted { color:#666; font-size: 13px; line-height:1.5; }
    .result h2 { margin:0 0 10px; font-size:18px; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid #ddd; margin:4px 6px 0 0; }
    pre { white-space: pre-wrap; word-break: break-word; background:#f4f4f4; padding:10px; border-radius:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸ¥— ì˜ì–‘ì†Œ ì¶”ì²œ ì„¤ë¬¸</h1>
      <div class="muted">ì„¤ë¬¸ì— ë‹µí•˜ë©´ 10ê°œ ì˜ì–‘ì†Œ(ë¹„íƒ€ë¯¼ D, ë§ˆê·¸ë„¤ìŠ˜, ì˜¤ë©”ê°€-3, ë¹„íƒ€ë¯¼ B12, ì² ë¶„, ì•„ì—°, ì¹¼ìŠ˜, í”„ë¡œë°”ì´ì˜¤í‹±ìŠ¤, ë¹„íƒ€ë¯¼ C, ë°€í¬ì‹œìŠ¬) ì¤‘ TOP 3ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</div>
    </div>

    <div id="form"></div>

    <div class="card">
      <button id="submitBtn" disabled>ê²°ê³¼ ë³´ê¸°</button>
      <div class="muted" style="margin-top:10px;">ë³¸ ê²°ê³¼ëŠ” ì •ë³´ ì œê³µ ëª©ì ì´ë©° ì˜ë£Œ ì§„ë‹¨/ì¹˜ë£Œê°€ ì•„ë‹™ë‹ˆë‹¤.</div>
    </div>

    <div class="card result" id="result" style="display:none;">
      <h2>ì¶”ì²œ ê²°ê³¼</h2>
      <div id="top3"></div>
      <div class="muted" style="margin-top:10px;">ëª¨ë¸ ì…ë ¥ ë¬¸ì¥</div>
      <pre id="inputText"></pre>
      <div class="muted" id="disclaimer" style="margin-top:10px;"></div>
    </div>
  </div>

<script>
  // âœ… ì„œë²„ì—ì„œ í‘œì¤€ í‚¤: sleep_timeìœ¼ë¡œ ê³ ì •
  const QUESTIONS = [
    { key:"age", title:"Q1. ë‚˜ì´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”", options:["10ëŒ€","20ëŒ€","30ëŒ€","40ëŒ€","50ëŒ€ ì´ìƒ"] },
    { key:"gender", title:"Q2. ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”", options:["ë‚¨ì„±","ì—¬ì„±","ì„ì‹ /ìˆ˜ìœ  ì¤‘","ê¸°íƒ€","ì‘ë‹µ ì•ˆ í•¨"] },
    { key:"sleep_time", title:"Q3. í•˜ë£¨ í‰ê·  ìˆ˜ë©´ ì‹œê°„ì€?", options:["4ì‹œê°„ ì´í•˜","5~6ì‹œê°„","6~7ì‹œê°„","7~8ì‹œê°„","ì¶©ë¶„í•¨"] },
    { key:"sleep_quality", title:"Q4. ìˆ˜ë©´ì˜ ì§ˆì€ ì–´ë–¤ê°€ìš”?", options:["ì ë“¤ê¸° ì–´ë µê³  ìì£¼ ê¹¸","ìì£¼ ì„¤ì¹˜ëŠ” í¸","ìê³  ë‚˜ë„ í”¼ê³¤í•¨","ë³´í†µ","ë§¤ìš° ì¢‹ìŒ"] },
    { key:"fatigue", title:"Q5. í‰ì†Œ í”¼ë¡œê°ì€ ì–´ë–¤ê°€ìš”?", options:["í•­ìƒ í”¼ê³¤í•¨","ìì£¼ í”¼ê³¤í•¨","ê°€ë” í”¼ê³¤í•¨","ê±°ì˜ ì—†ìŒ","ì „í˜€ ì—†ìŒ"] },
    { key:"diet", title:"Q6. í‰ì†Œ ì‹ìŠµê´€ì€?", options:["ë§¤ìš° ë¶ˆê·œì¹™","íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ìœ„ì£¼","íƒ„ìˆ˜í™”ë¬¼ ìœ„ì£¼","ë¹„êµì  ê· í˜•ì ","ì•„ì£¼ ê±´ê°•í•¨"] },
    { key:"stress", title:"Q7. ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì€?", options:["ë§¤ìš° ë†’ìŒ","ë†’ìŒ","ë³´í†µ","ë‚®ìŒ","ê±°ì˜ ì—†ìŒ"] },
    { key:"digestion", title:"Q8. ì†Œí™” ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?", options:["ë³€ë¹„ ì¦ìŒ","ì„¤ì‚¬ ì¦ìŒ","ë”ë¶€ë£©í•¨","ê°€ë” ë¶ˆí¸","ë¬¸ì œ ì—†ìŒ"] },
    { key:"alcohol", title:"Q9. ìŒì£¼ ë¹ˆë„ëŠ”?", options:["ê±°ì˜ ë§¤ì¼","ì£¼ 3~4íšŒ","ì£¼ 1~2íšŒ","ê±°ì˜ ì•ˆ í•¨","ì „í˜€ ì•ˆ í•¨"] },
    { key:"sunlight", title:"Q10. ì•¼ì™¸ í™œë™ / í–‡ë¹› ë…¸ì¶œì€?", options:["ê±°ì˜ ì—†ìŒ","ë§¤ìš° ì ìŒ","ë³´í†µ","ë§ì€ í¸","ë§¤ìš° ë§ìŒ"] },
  ];

  const state = {}; // {key: 1..5}
  const formDiv = document.getElementById("form");
  const submitBtn = document.getElementById("submitBtn");

  function render() {
    formDiv.innerHTML = "";
    QUESTIONS.forEach((q) => {
      const card = document.createElement("div");
      card.className = "card";

      const title = document.createElement("div");
      title.className = "q";
      title.textContent = q.title;
      card.appendChild(title);

      const opts = document.createElement("div");
      opts.className = "opts";

      q.options.forEach((opt, idx) => {
        const label = document.createElement("label");
        const input = document.createElement("input");
        input.type = "radio";
        input.name = q.key;
        input.value = String(idx + 1);
        input.checked = state[q.key] === (idx + 1);
        input.addEventListener("change", () => {
          state[q.key] = idx + 1;
          submitBtn.disabled = !isComplete();
        });
        label.appendChild(input);
        label.appendChild(document.createTextNode(`${idx + 1}. ${opt}`));
        opts.appendChild(label);
      });

      card.appendChild(opts);
      formDiv.appendChild(card);
    });
  }

  function isComplete() {
    return QUESTIONS.every(q => typeof state[q.key] === "number");
  }

  submitBtn.addEventListener("click", async () => {
    if (!isComplete()) return;

    submitBtn.disabled = true;
    submitBtn.textContent = "ì¶”ë¡  ì¤‘...";

    try {
      const resp = await fetch("/predict", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(state),
      });

      if (!resp.ok) {
        const t = await resp.text();
        throw new Error(`API error: ${resp.status}\n${t}`);
      }

      const data = await resp.json();

      document.getElementById("result").style.display = "block";
      document.getElementById("inputText").textContent = data.input_text || "";
      document.getElementById("disclaimer").textContent = data.disclaimer || "";

      const top3Div = document.getElementById("top3");
      top3Div.innerHTML = "";
      (data.top3 || []).forEach((r, i) => {
        const pill = document.createElement("div");
        pill.className = "pill";
        pill.textContent = `${i+1}ìœ„: ${r.label} (ì‹ ë¢°ë„ ${Number(r.confidence).toFixed(2)})`;
        top3Div.appendChild(pill);
      });

      // ìŠ¤í¬ë¡¤ ì´ë™(ëª¨ë°”ì¼ UX)
      document.getElementById("result").scrollIntoView({behavior:"smooth"});
    } catch (e) {
      alert(e.message);
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "ê²°ê³¼ ë³´ê¸°";
    }
  });

  render();
</script>
</body>
</html>
